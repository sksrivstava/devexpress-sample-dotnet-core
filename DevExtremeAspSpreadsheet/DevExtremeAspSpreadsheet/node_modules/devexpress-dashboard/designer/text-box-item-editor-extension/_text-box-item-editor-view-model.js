/**
* DevExpress Dashboard (_text-box-item-editor-view-model.js)
* Version:  20.1.6
* Build date: Jul 17, 2020
* Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED
* License: https://www.devexpress.com/Support/EULAs/universal.xml
*/
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ko = require("knockout");
var index_internal_1 = require("../../data/index.internal");
var _confirm_dialog_1 = require("../confirm-dialog/_confirm-dialog");
var ValueAccessor = (function () {
    function ValueAccessor() {
    }
    return ValueAccessor;
}());
exports.ValueAccessor = ValueAccessor;
var RichEditExtensionViewModel = (function () {
    function RichEditExtensionViewModel() {
        var _this = this;
        this._isCloseConfirmed = false;
        this.richEditorOptions = ko.observable(null);
        this.close = function () {
            _this.popup.hide();
        };
        this.saveAndClose = function () {
            var richEditorOptions = _this.richEditorOptions();
            richEditorOptions && richEditorOptions.forceSave && richEditorOptions.forceSave();
            _this.close();
        };
        this.onHidden = function () {
            _this.richEditorOptions(null);
            _this._isCloseConfirmed = false;
        };
        this.onHiding = function (args) {
            var richEditorOptions = _this.richEditorOptions();
            var documentModified = richEditorOptions && richEditorOptions.documentModified && richEditorOptions.documentModified();
            if (documentModified && !_this._isCloseConfirmed) {
                args.cancel = true;
                _this.confirmDialogViewModel
                    .confirm(index_internal_1.getLocalizationById('DashboardWebStringId.Dialog.ConfirmSaving'), index_internal_1.getLocalizationById('DashboardWebStringId.SaveConfirmationDialogMessage') + '<br/>' + index_internal_1.getLocalizationById('DashboardWebStringId.SaveChangesDialogMessage'), index_internal_1.getLocalizationById('DashboardWebStringId.Dialog.Save'), index_internal_1.getLocalizationById('DashboardWebStringId.Dialog.DoNotSave'))
                    .done(function (result) {
                    _this._isCloseConfirmed = true;
                    if (result) {
                        _this.saveAndClose();
                    }
                    else {
                        _this.close();
                    }
                });
            }
        };
        this.onInitialized = function (args) {
            _this.popup = args.component;
        };
        this.confirmDialogViewModel = new _confirm_dialog_1.ConfirmDialogViewModel();
    }
    RichEditExtensionViewModel.prototype.show = function (options, docVariables, dashboardItemWidth) {
        var _this = this;
        if (!this.richEditorOptions()) {
            this.popup.show().then(function () {
                _this.richEditorOptions({
                    initialDocument: options.getValue(),
                    docVariables: docVariables,
                    onSaving: function (document) {
                        options.setValue(document);
                    },
                    dashboardItemWidth: dashboardItemWidth
                });
            });
        }
    };
    return RichEditExtensionViewModel;
}());
exports.RichEditExtensionViewModel = RichEditExtensionViewModel;
